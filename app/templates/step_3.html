{% extends 'base.html' %}
{% block title %} Step 3 {% endblock %}

{% block content %}
<style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css");

    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #f8f9fa;
    }

    #step3-ui {
        --nav-h: 96px;
        --bg: #f8f9fa;
        --panel: #f8f9fa;
        --line: #8e8e8e;
        --text: #2f2f2f;
        --muted: #6f6f6f;
        --water:   linear-gradient(180deg, #f89a5a, #eb6218);
        --infra:   linear-gradient(180deg, #b96ec2, #8f22a6);
        --live:    linear-gradient(180deg, #43a34f, #1f7a2b);
        --disaster:linear-gradient(180deg, #67c3f2, #2f92cd);

        width: 100%;
        max-width: 100%;
        height: calc(100vh - var(--nav-h));
        max-height: calc(100vh - var(--nav-h));
        box-sizing: border-box;
        margin: 0;
        padding: 10px 16px;
        background: #f8f9fa;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        color: var(--text);
        overflow: hidden;
    }

    #step3-ui * {
        box-sizing: border-box;
    }

    /* ── Main Layout */
    #step3-ui .step3-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        height: 100%;
        min-height: 0;
        background: var(--panel);
        border-top: 2px solid var(--line);
        border-bottom: 2px solid var(--line);
    }

    #step3-ui .panel {
        padding: 14px 16px;
        min-height: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    #step3-ui .left-panel {
        border-right: 2px solid var(--line);
    }

    /* ── Panel Headings */
    #step3-ui .panel-heading {
        text-align: center;
        font-size: 20px;
        font-weight: 700;
        color: #464646;
        margin: 0 0 10px;
    }

    /* Tables */
    #step3-ui .table-wrap {
        border: 2px solid var(--line);
        overflow-y: auto;
        background: #f8f9fa;
        flex: 1;
        min-height: 0;
    }

    #step3-ui table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }

    #step3-ui th {
        background: #efefef;
        color: #4c4c4c;
        padding: 6px 8px;
        font-size: 12px;
        border: 1px solid #a5a5a5;
        position: sticky;
        top: 0;
        z-index: 1;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    #step3-ui td {
        padding: 6px 8px;
        font-size: 12px;
        border: 1px solid #a5a5a5;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: var(--text);
    }

    #step3-ui .icon-col {
        text-align: center;
        width: 36px;
    }

    #step3-ui .icon-btn {
        border: 0;
        background: transparent;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
    }

    #step3-ui .view-btn  { color: #5f5f5f; }
    #step3-ui .arrow-btn { color: #0091ff; }
    #step3-ui .delete-btn { color: #c11414; }

    #step3-ui .empty-row {
        text-align: center;
        color: #757575;
        padding: 18px 8px;
    }

    /* Domain Cards */
    #step3-ui .domain-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 10px;
        margin-top: 12px;
        flex-shrink: 0;
    }

    #step3-ui .domain-item .label {
        text-align: center;
        margin-bottom: 4px;
        font-size: 12px;
        font-weight: 700;
        min-height: 28px;
        color: var(--text);
    }

    #step3-ui .domain-item .count-card {
        height: 66px;
        border-radius: 14px;
        color: #fff;
        font-size: 30px;
        font-weight: 700;
        display: grid;
        place-items: center;
        box-shadow: inset 0 2px 7px rgba(0,0,0,0.2);
    }

    /* Right Panel */
    #step3-ui .about-work {
        margin-top: 12px;
        flex-shrink: 0;
    }

    #step3-ui .about-work h4 {
        margin: 0 0 8px;
        text-align: center;
        font-size: 20px;
        font-weight: 700;
        color: #464646;
    }

    #step3-ui .about-content {
        border: 2px solid #a5a5a5;
        border-radius: 10px;
        background: #f8f9fa;
        min-height: 80px;
        max-height: 130px;
        padding: 10px;
        font-size: 12px;
        line-height: 1.35;
        white-space: pre-line;
        overflow: hidden;
        color: var(--text);
    }

    #step3-ui .about-content.muted {
        color: var(--muted);
    }

    /* Footer Buttons */
    #step3-ui .step3-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 12px;
        flex-shrink: 0;
    }

    #step3-ui .btn-back {
        height: 40px;
        padding: 0 24px;
        border: 2px solid #747474;
        border-radius: 20px;
        background: linear-gradient(180deg, #9a9a9a, #7e7e7e);
        color: #fff;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
    }

    #step3-ui .btn-next {
        height: 40px;
        padding: 0 24px;
        border: 2px solid #0070cc;
        border-radius: 20px;
        background: linear-gradient(180deg, #33aaff, #0070cc);
        color: #fff;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
    }

    @media (max-width: 900px) {
        #step3-ui .step3-layout {
            grid-template-columns: 1fr;
        }
        #step3-ui .left-panel {
            border-right: none;
            border-bottom: 2px solid var(--line);
        }
    }
</style>

<section id="step3-ui">
    <div class="step3-layout">

        <!-- Viksit Gram Panchayat Stack -->
        <div class="panel left-panel">
            <div class="panel-heading">Viksit Gram Panchayat Stack</div>

            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Theme</th>
                            <th>Group</th>
                            <th>Work</th>
                            <th>Beneficiary</th>
                            <th>Type</th>
                            <th class="icon-col"><i class="fa-solid fa-eye"></i></th>
                            <th class="icon-col"><i class="fa-solid fa-arrow-right"></i></th>
                        </tr>
                    </thead>
                    <tbody id="schemeTableBody">
                        {% for scheme in schemes %}
                        <tr>
                            <td>{{ scheme.theme }}</td>
                            <td>{{ scheme.group }}</td>
                            <td>{{ scheme.work }}</td>
                            <td>{{ scheme.beneficiary }}</td>
                            <td>{{ scheme.work_type }}</td>
                            <td class="icon-col">
                                <button class="icon-btn view-btn" title="View">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                            <td class="icon-col">
                                <button class="icon-btn arrow-btn" title="Go">
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="empty-row">No data available.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Domain Cards  -->
            <div class="domain-grid" id="domainCards">
                <div class="domain-item">
                    <div class="label">Water Security</div>
                    <div class="count-card" style="background: var(--water)">
                        {{ stats.water_security if stats.water_security is defined and stats.water_security != None else '-' }}
                    </div>
                </div>
                <div class="domain-item">
                    <div class="label">Rural Infrastructure</div>
                    <div class="count-card" style="background: var(--infra)">
                        {{ stats.rural_infrastructure if stats.rural_infrastructure is defined and stats.rural_infrastructure != None else '-' }}
                    </div>
                </div>
                <div class="domain-item">
                    <div class="label">Rural Livelihood</div>
                    <div class="count-card" style="background: var(--live)">
                        {{ stats.rural_livelihood if stats.rural_livelihood is defined and stats.rural_livelihood != None else '-' }}
                    </div>
                </div>
                <div class="domain-item">
                    <div class="label">Disaster Management</div>
                    <div class="count-card" style="background: var(--disaster)">
                        {{ stats.disaster_management if stats.disaster_management is defined and stats.disaster_management != None else '-' }}
                    </div>
                </div>
            </div>
        </div>

        <!--  Annual Action Plan -->
        <div class="panel right-panel">
            <div class="panel-heading">Annual Action Plan</div>

            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Work</th>
                            <th class="icon-col"><i class="fa-solid fa-eye"></i></th>
                            <th class="icon-col"><i class="fa-solid fa-trash"></i></th>
                        </tr>
                    </thead>
                    <tbody id="aapTableBody">
                        {% for item in aap_items %}
                        <tr>
                            <td>{{ item.activity }}</td>
                            <td class="icon-col">
                                <button class="icon-btn view-btn" title="View">
                                    <i class="fa-solid fa-eye"></i>
                                </button>
                            </td>
                            <td class="icon-col">
                                <button class="icon-btn delete-btn" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" class="empty-row">No work added yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- About Work -->
            <div class="about-work">
                <h4>About the Work</h4>
                <div id="aboutWorkContent" class="about-content muted">
                    Select a row using the eye icon to view details.
                </div>
            </div>

            <!-- Footer -->
            <div class="step3-footer">
                <button class="btn-back" onclick="window.location.href='{{ url_for('routes.step_2') }}'">Back</button>
                <button class="btn-next" onclick="window.location.href='{{ url_for('routes.step_4') }}'">Next</button>
            </div>
        </div>

    </div>
</section>

<script>
(function () {
    function fitToViewport() {
        const navbar = document.querySelector(".navbar");
        const navHeight = navbar ? navbar.offsetHeight : 96;
        document.getElementById("step3-ui").style.setProperty("--nav-h", navHeight + "px");
    }
    window.addEventListener("resize", fitToViewport);
    fitToViewport();
}());
</script>

{% endblock %}